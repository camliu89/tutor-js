#!/bin/bash

set -e

if [ "$TRAVIS" == "true" ]; then
    echo "running under travis, fetching master"
    TARGET_BRANCH=$TRAVIS_BRANCH
    git remote set-branches --add origin $TARGET_BRANCH
    git fetch
else
    TARGET_BRANCH=master
fi

if [ "$1" == "branch" ]; then
    head=$(git merge-base HEAD $TARGET_BRANCH)
    cmd="git diff --name-status $head $BRANCH */{src,specs}"
else
    cmd="git status --short */{src,specs}"
fi

files=`eval $cmd | egrep '^[^D].*(jsx?)$' | awk '{ print $2 }'`

if [ ! -z "$files" ]; then
    $(npm bin)/eslint $2 $files
fi
