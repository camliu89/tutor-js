#!/bin/bash

set -e

PROJECT=${OX_PROJECT:=tutor}

HEAD=head

if [ "$TRAVIS" == "true" ]; then
    echo "running under travis, fetching master"
    # fetch master so it can be compared
    git remote set-branches --add origin master
    git fetch
    HEAD=$TRAVIS_COMMIT
fi

if [ "$1" == "branch" ]; then
    cmd="git diff-tree -r --diff-filter=ACMR --no-commit-id --name-only origin/master $HEAD ${PROJECT}/src ${PROJECT}/specs"
    echo $cmd
    echo `${cmd}`
    ${cmd} | grep -E '.jsx$|.js$' | xargs $(npm bin)/eslint $2
else
    git status --short --porcelain ${PROJECT}/src ${PROJECT}/specs | awk '{ print $2 }' | grep -E '.jsx$|.js$' | xargs $(npm bin)/eslint
fi
